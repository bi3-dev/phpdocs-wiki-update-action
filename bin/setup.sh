#!/usr/bin/env bash

ENGINE="$1"

ACTION_SUFFIX="${GITHUB_SHA}-${GITHUB_RUN_ID}-${GITHUB_RUN_ATTEMPT}"
OLD_WIKI_CHECKOUT_PATH="${RUNNER_TEMP}/old-wiki-${ACTION_SUFFIX}"
NEW_WIKI_CHECKOUT_PATH="${RUNNER_TEMP}/new-wiki-${ACTION_SUFFIX}"
TMP_BRANCH_MAP_FILE="${RUNNER_TEMP}/branches-map-${ACTION_SUFFIX}"
ACTION_BIN_PATH="${GITHUB_ACTION_PATH}/bin"

if [ "$ENGINE" == "evert/phpdoc-md" ]; then
  NEEDED_PHP_VERSION=7.4
elif [ "$ENGINE" == "clean/phpdoc-md" ]; then
  NEEDED_PHP_VERSION=8.3
else
  echo 'ERROR: unknown engine'

  exit 1
fi;

echo "OLD_WIKI_CHECKOUT_PATH=$OLD_WIKI_CHECKOUT_PATH" >> $GITHUB_ENV
echo "NEW_WIKI_CHECKOUT_PATH=$NEW_WIKI_CHECKOUT_PATH" >> $GITHUB_ENV
echo "NEEDED_PHP_VERSION=$NEEDED_PHP_VERSION" >> $GITHUB_ENV
echo "ACTION_BIN_PATH=$ACTION_BIN_PATH" >> $GITHUB_ENV
echo "TMP_BRANCH_MAP_FILE=$TMP_BRANCH_MAP_FILE" >> $GITHUB_ENV

rm -rf "$OLD_WIKI_CHECKOUT_PATH" || true
rm -rf "$NEW_WIKI_CHECKOUT_PATH" || true

mkdir -p "$NEW_WIKI_CHECKOUT_PATH"
